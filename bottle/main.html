<html>
<head>
	<title>Bottle</title>
    <meta http-equiv="Content-Language" Content="en"/>
	<meta charset="windows-1251">
	<link rel="stylesheet" type="text/css" href="resources/style.css">
	<link rel="stylesheet" type="text/css" href="resources/chat.css">
</head>
<body>
	<script type="text/javascript" src="main.js"></script>
	<script type="text/javascript">


        function getAge(bdate) {
            if (bdate == null || bdate == undefined) return null;
            var bdateArr = bdate.split(".");
            for (var i = 0; i < bdateArr.length; i++) {
                if (bdateArr[i].length == 4) {
                    return parseInt(bdateArr[i]);
                }
            }
            return null;
        }

		function parseVkData(){
 			var rawData = document.location.search.substr(1).split("&");
            var data = {};
            var user = {};
            for (i = 0; i < rawData.length; i++) {
                var keyValue = rawData[i].split('=');
                data[ keyValue[0] ] = keyValue[1];
            }
            var api_result = JSON.parse(decodeURIComponent(  data["api_result"] ));  
            user = api_result.response.userInfo[0];
            user.city_name = api_result.response.cityName[0];
            user.id = user.external_id = user.uid;
            user.photo = user.photo_big;
            user.auth_key = data.auth_key;
            user.age = getAge(user.bdate);
            console.log("PARSING!");
            console.log(data);
            console.log(api_result);
            console.log(user);
            bottle.main.run(user);
 		}
 		parseVkData();




	</script>
</body>
</html>
